[tools]
# Languages
python = "3.12.8"
node = "22.16.0"
go = "1.22.0"
rust = "latest"

# Package managers
pnpm = "10.11.0"

# Modern CLI tools  
bat = "0.25.0"
fd = "10.2.0"
fzf = "0.62.0"
eza = "latest"  # exa replacement
hyperfine = "1.19.0"
ripgrep = "14.1.1"
gum = "latest"
btop = "latest"

# Development tools
lazygit = "0.51.1"
github-cli = "2.74.0"
k9s = "0.50.6"
dive = "0.13.1"
starship = "1.23.0"

# Linters
shellcheck = "0.9.0"
shfmt = "3.7.0"
yamllint = "1.33.0"
golangci-lint = "1.55.2"

# Utils
jq = "1.7.1"
yq = "4.45.4"
zoxide = "latest"
# tmux = "latest"  # Comment out - needs system libs (ncurses-dev), better to use system package

[tasks.test]
run = "echo 'Running tests...'"
description = "Run project tests"

[tasks.lint]
run = ["shellcheck scripts/*.sh", "yamllint ."]
description = "Lint all files"

[tasks.setup]
run = ["./.scripts/auto-install.sh", "./.scripts/install-system-deps.sh"]
description = "Complete setup - auto-install everything possible"

[tasks.auto-install]
run = "./.scripts/auto-install.sh"
description = "Install everything possible without sudo"

[tasks.system-deps]
run = "./.scripts/install-system-deps.sh"
description = "Install system dependencies (tmux, build tools, etc.)"

[tasks.sync]
run = "./.scripts/auto-sync.sh"
description = "Auto-sync dotfiles, tokens, and SSH hosts"

[tasks.update]
run = "mise upgrade && mise install"
description = "Update all tools to latest versions"

[tasks.gateway-backup]
run = "./.scripts/backup-tabby-gateway.sh"
description = "Backup Tabby gateway data to GitHub gist"

[tasks.gateway-sync]
run = "./.scripts/tabby-gateway-config.sh sync"
description = "Sync Tabby gateway config from gist"

[tasks.gateway-deploy]
run = "./.scripts/deploy-tabby-gateway.sh"
description = "Deploy Tabby gateway container"

[tasks.gateway-schedule]
run = """
  echo "ðŸ• Setting up scheduled gateway backups..."
  
  # Create systemd timer for daily backups
  cat > /tmp/tabby-gateway-backup.timer << 'EOF'
[Unit]
Description=Daily Tabby Gateway Backup
Requires=tabby-gateway-backup.service

[Timer]
OnCalendar=daily
OnCalendar=*-*-* 03:00:00
Persistent=true

[Install]
WantedBy=timers.target
EOF

  cat > /tmp/tabby-gateway-backup.service << 'EOF'
[Unit]
Description=Backup Tabby Gateway
After=network.target

[Service]
Type=oneshot
ExecStart=/home/mhugo/.dotfiles/.scripts/backup-tabby-gateway.sh
User=mhugo
EOF

  echo "Timer and service files created in /tmp/"
  echo "To install: sudo mv /tmp/tabby-gateway-backup.* /etc/systemd/system/ && sudo systemctl enable tabby-gateway-backup.timer"
  
  # Alternative: cron job
  echo ""
  echo "Or add to crontab:"
  echo "0 3 * * * /home/mhugo/.dotfiles/.scripts/backup-tabby-gateway.sh >> /home/mhugo/.dotfiles/logs/gateway-backup.log 2>&1"
"""
description = "Setup scheduled backups for Tabby gateway"
